import{_ as Y,r,e as Z,f as ee,C as S,D as se,c as a,k as te,d as b,a as l,E as le,G as k,t as c,T as oe,F as H,l as L,q as C,s as m,n as h,x as j,H as R,I as ae,o as n,A as F,B as V,J as q,m as E}from"./index-BmQksIZ3.js";import{g as ne}from"./puzzleRotation-7FSjlPX_.js";const ie={class:"admin-view"},re={key:0,class:"modal-overlay"},ue={class:"modal-content glass-panel"},ce={class:"modal-actions"},de={class:"header-container"},ve={class:"titles"},pe={class:"subheading"},ze={key:1,class:"display-puzzle-card-3d"},he={key:0,class:"card-content"},ye={class:"movie-name"},fe={class:"card-footer"},me={class:"author"},ge={key:1,class:"card-content empty"},_e={key:2,class:"loading-state"},be={key:3,class:"dashboard"},ke={class:"floating-sidebar"},we={key:0,class:"loading-state"},Pe={key:1,class:"empty-state glass-panel"},Ce={key:2,class:"empty-state glass-panel"},je={key:3,class:"empty-state glass-panel"},Ae={key:4,class:"empty-state glass-panel"},De={key:5,class:"puzzles-list"},qe={class:"puzzle-header"},Ee={class:"puzzle-info"},Ne={class:"movie-title"},Be={class:"meta-info"},$e={class:"submitter"},xe={class:"clue-count"},Te={key:0,class:"actions"},Se=["onClick"],He=["onClick"],Le={key:1,class:"actions"},Re={class:"expected-date-badge"},Fe=["onClick"],Ve={key:2,class:"actions"},Ie=["onClick"],Me=["onClick"],Oe={key:3,class:"actions"},Qe=["onClick"],Ge={class:"clues-section"},Je={class:"clues-list"},Ke={class:"clue-number"},Ue={class:"clue-text"},We={__name:"AdminView",setup(Xe){const N=se(),A=r(!1),I=r(""),M=r("");r(""),r(!1);const D=r(!0),u=r([]),d=r([]),p=r([]),f=r([]),z=r(!1),i=r("queue"),g=r(null),_=r({show:!1,message:"",type:""}),y=r({show:!1,title:"",message:"",onConfirm:null}),v=(s,e="success")=>{_.value={show:!0,message:s,type:e},setTimeout(()=>{_.value.show=!1},3e3)},O=(s,e,t)=>{y.value={show:!0,title:s,message:e,onConfirm:async()=>{await t(),y.value.show=!1}}},Q=Z(()=>{switch(i.value){case"queue":return"Queue (Pending)";case"approved":return"Approved Puzzles";case"rejected":return"Rejected Puzzles";case"history":return"Archived History";default:return"Dashboard"}}),B=async()=>{z.value=!0;try{const s=C(m(h,"waitingPuzzles")),e=await j(s);u.value=e.docs.map(t=>({id:t.id,...t.data()}))}catch(s){console.error("Error fetching puzzles:",s),v("Error fetching pending puzzles","error")}finally{z.value=!1}},G=async()=>{z.value=!0;try{const s=C(m(h,"approvedPuzzles"),R("createdAt","asc")),e=await j(s);d.value=e.docs.map(t=>({id:t.id,...t.data()}))}catch(s){console.error("Error fetching approved puzzles:",s),v("Error fetching approved puzzles","error")}finally{z.value=!1}},J=s=>{const e=new Date,t=5.5*60*60*1e3,o=new Date(e.getTime()+t),P=g.value?1:0;return o.setDate(o.getDate()+P+s),o.toLocaleDateString("en-IN",{weekday:"short",day:"numeric",month:"short"})},K=async()=>{z.value=!0;try{const s=C(m(h,"rejectedPuzzles")),e=await j(s);p.value=e.docs.map(t=>({id:t.id,...t.data()}))}catch(s){console.error("Error fetching rejected puzzles:",s),v("Error fetching rejected puzzles","error")}finally{z.value=!1}},U=async()=>{z.value=!0;try{const s=C(m(h,"historyPuzzles"),R("movedToHistoryAt","desc"),ae(50)),e=await j(s);f.value=e.docs.map(t=>({id:t.id,...t.data()}))}catch(s){console.error("Error fetching history puzzles:",s),v("Error fetching history","error")}finally{z.value=!1}},w=s=>{i.value=s,s==="queue"?B():s==="approved"?G():s==="rejected"?K():s==="history"&&U()},W=async()=>{try{const s=await ne();g.value=s}catch(s){console.error("Error fetching display puzzle:",s)}};ee(()=>{S.onAuthStateChanged(s=>{s?(A.value=!0,B(),W()):N.push("/"),D.value=!1})});const $=async s=>{try{const e=u.value.find(o=>o.id===s)||p.value.find(o=>o.id===s);if(!e){console.error("Puzzle not found");return}const t=u.value.find(o=>o.id===s)?"waitingPuzzles":"rejectedPuzzles";await F(m(h,"approvedPuzzles"),{movieName:e.movieName,submittedBy:e.submittedBy,clues:e.clues,createdAt:e.createdAt,approvedAt:V()}),await q(E(h,t,s)),u.value=u.value.filter(o=>o.id!==s),p.value=p.value.filter(o=>o.id!==s),v("Puzzle approved successfully!","success")}catch(e){console.error("Error approving puzzle:",e),v("Failed to approve puzzle","error")}},x=async s=>{try{const e=u.value.find(o=>o.id===s)||d.value.find(o=>o.id===s);if(!e){console.error("Puzzle not found");return}const t=u.value.find(o=>o.id===s)?"waitingPuzzles":"approvedPuzzles";await F(m(h,"rejectedPuzzles"),{movieName:e.movieName,submittedBy:e.submittedBy,clues:e.clues,createdAt:e.createdAt,rejectedAt:V()}),await q(E(h,t,s)),u.value=u.value.filter(o=>o.id!==s),d.value=d.value.filter(o=>o.id!==s),v("Puzzle rejected","success")}catch(e){console.error("Error rejecting puzzle:",e),v("Failed to reject puzzle","error")}},T=async s=>{O("Delete Puzzle","Are you sure you want to permanently delete this puzzle?",async()=>{try{let e="waitingPuzzles";d.value.find(t=>t.id===s)?e="approvedPuzzles":p.value.find(t=>t.id===s)?e="rejectedPuzzles":f.value.find(t=>t.id===s)&&(e="historyPuzzles"),await q(E(h,e,s)),u.value=u.value.filter(t=>t.id!==s),d.value=d.value.filter(t=>t.id!==s),p.value=p.value.filter(t=>t.id!==s),f.value=f.value.filter(t=>t.id!==s),v("Puzzle deleted permanently","success")}catch(e){console.error("Error deleting puzzle:",e),v("Failed to delete puzzle","error")}})},X=async()=>{try{await S.signOut(),A.value=!1,I.value="",M.value="",N.push("/")}catch(s){console.error("Error logging out:",s)}};return(s,e)=>(n(),a("div",ie,[te(oe,{name:"slide-down"},{default:le(()=>[_.value.show?(n(),a("div",{key:0,class:k(["notification",_.value.type])},c(_.value.message),3)):b("",!0)]),_:1}),y.value.show?(n(),a("div",re,[l("div",ue,[l("h3",null,c(y.value.title),1),l("p",null,c(y.value.message),1),l("div",ce,[l("button",{onClick:e[0]||(e[0]=t=>y.value.show=!1),class:"btn-cancel"},"Cancel"),l("button",{onClick:e[1]||(e[1]=(...t)=>y.value.onConfirm&&y.value.onConfirm(...t)),class:"btn-confirm"},"Confirm")])])])):b("",!0),l("div",de,[l("div",ve,[e[6]||(e[6]=l("h1",{class:"title"},"Admin Dashboard",-1)),l("h2",pe,c(Q.value),1)])]),!D.value&&A.value?(n(),a("div",ze,[g.value?(n(),a("div",he,[b("",!0),e[8]||(e[8]=l("div",{class:"card-header"},[l("h3",null,"ðŸŽ¯ Live Now"),l("span",{class:"pulse-dot"})],-1)),l("div",ye,c(g.value.movieName),1),l("div",fe,[l("span",me,"by "+c(g.value.submittedBy),1),e[7]||(e[7]=l("span",{class:"expiry"},"Expires 11:59 PM",-1))])])):(n(),a("div",ge,[...e[9]||(e[9]=[l("p",null,"âš ï¸ No active puzzle",-1),l("span",{class:"auto-note"},"Auto-fill active",-1)])]))])):b("",!0),D.value?(n(),a("div",_e,[...e[10]||(e[10]=[l("div",{class:"spinner"},null,-1),l("p",null,"Checking authentication...",-1)])])):(n(),a("div",be,[l("div",ke,[l("button",{onClick:e[2]||(e[2]=t=>w("queue")),class:k(["sidebar-btn",{active:i.value==="queue"}]),title:"Queue (Pending)"}," â³ ",2),l("button",{onClick:e[3]||(e[3]=t=>w("approved")),class:k(["sidebar-btn",{active:i.value==="approved"}]),title:"Approved"}," âœ¨ ",2),l("button",{onClick:e[4]||(e[4]=t=>w("rejected")),class:k(["sidebar-btn",{active:i.value==="rejected"}]),title:"Rejected"}," ðŸ—‘ï¸ ",2),l("button",{onClick:e[5]||(e[5]=t=>w("history")),class:k(["sidebar-btn",{active:i.value==="history"}]),title:"Archives (History)"}," ðŸ“œ ",2),e[11]||(e[11]=l("div",{class:"sidebar-divider"},null,-1)),l("button",{onClick:X,class:"sidebar-btn logout-btn",title:"Logout"}," ðŸ‘‹ ")]),z.value?(n(),a("div",we,[...e[12]||(e[12]=[l("div",{class:"spinner"},null,-1),l("p",null,"Loading puzzles...",-1)])])):i.value==="queue"&&u.value.length===0?(n(),a("div",Pe,[...e[13]||(e[13]=[l("p",null,"No pending puzzles to review.",-1)])])):i.value==="approved"&&d.value.length===0?(n(),a("div",Ce,[...e[14]||(e[14]=[l("p",null,"No approved puzzles yet.",-1)])])):i.value==="rejected"&&p.value.length===0?(n(),a("div",je,[...e[15]||(e[15]=[l("p",null,"No rejected puzzles.",-1)])])):i.value==="history"&&f.value.length===0?(n(),a("div",Ae,[...e[16]||(e[16]=[l("p",null,"No archived puzzles.",-1)])])):(n(),a("div",De,[(n(!0),a(H,null,L(i.value==="queue"?u.value:i.value==="approved"?d.value:i.value==="rejected"?p.value:f.value,t=>(n(),a("div",{key:t.id,class:"puzzle-card glass-panel"},[l("div",qe,[l("div",Ee,[l("h3",Ne,"ðŸŽ¬ "+c(t.movieName),1),l("div",Be,[l("span",$e,"ðŸ‘¤ "+c(t.submittedBy),1),l("span",xe,"ðŸ“ "+c(t.clues.length)+" clues",1)])]),i.value==="queue"?(n(),a("div",Te,[l("button",{onClick:o=>$(t.id),class:"btn-approve"}," âœ“ Approve ",8,Se),l("button",{onClick:o=>x(t.id),class:"btn-reject"}," âœ• Reject ",8,He)])):i.value==="approved"?(n(),a("div",Le,[l("div",Re," ðŸ“… Live: "+c(J(d.value.findIndex(o=>o.id===t.id))),1),l("button",{onClick:o=>x(t.id),class:"btn-reject"}," âœ• Reject ",8,Fe)])):i.value==="rejected"?(n(),a("div",Ve,[l("button",{onClick:o=>$(t.id),class:"btn-approve"}," âœ“ Approve ",8,Ie),l("button",{onClick:o=>T(t.id),class:"btn-delete"}," ðŸ—‘ï¸ Delete ",8,Me)])):i.value==="history"?(n(),a("div",Oe,[l("button",{onClick:o=>T(t.id),class:"btn-delete"}," ðŸ—‘ï¸ Delete ",8,Qe)])):b("",!0)]),l("div",Ge,[e[17]||(e[17]=l("h4",{class:"clues-title"},"Clues (Hardest â†’ Easiest)",-1)),l("ol",Je,[(n(!0),a(H,null,L(t.clues,(o,P)=>(n(),a("li",{key:P,class:"clue-item"},[l("span",Ke,"#"+c(P+1),1),l("span",Ue,c(o),1)]))),128))])])]))),128))]))]))]))}},es=Y(We,[["__scopeId","data-v-8e0452a7"]]);export{es as default};
