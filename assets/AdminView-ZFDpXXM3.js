import{_ as J,r as u,e as K,f as U,x as $,y as X,c as a,a as l,d as C,t as p,n as _,F as x,k as S,q as b,l as h,m as z,p as k,z as F,A as Y,o as n,s as L,u as R,B as j,C as A}from"./index-BhwZ-e1m.js";import{g as Z}from"./puzzleRotation-DZ1vXEiY.js";const ee={class:"admin-view"},te={class:"header-container"},se={class:"titles"},le={class:"subheading"},oe={key:0,class:"display-puzzle-card-3d"},ae={key:0,class:"card-content"},ne={class:"movie-name"},ie={class:"card-footer"},re={class:"author"},ue={key:1,class:"card-content empty"},ce={key:1,class:"loading-state"},de={key:2,class:"dashboard"},ve={class:"floating-sidebar"},pe={key:0,class:"loading-state"},ze={key:1,class:"empty-state glass-panel"},ye={key:2,class:"empty-state glass-panel"},he={key:3,class:"empty-state glass-panel"},fe={key:4,class:"empty-state glass-panel"},me={key:5,class:"puzzles-list"},ge={class:"puzzle-header"},_e={class:"puzzle-info"},be={class:"movie-title"},ke={class:"meta-info"},Pe={class:"submitter"},we={class:"clue-count"},Ce={key:0,class:"actions"},je=["onClick"],Ae=["onClick"],qe={key:1,class:"actions"},De={class:"expected-date-badge"},Ee=["onClick"],Ne={key:2,class:"actions"},Be=["onClick"],$e=["onClick"],xe={key:3,class:"actions"},Se=["onClick"],Fe={class:"clues-section"},Le={class:"clues-list"},Re={class:"clue-number"},Te={class:"clue-text"},He={__name:"AdminView",setup(Ve){const q=X(),P=u(!1),T=u(""),H=u("");u(""),u(!1);const w=u(!0),r=u([]),c=u([]),d=u([]),y=u([]),v=u(!1),i=u("queue"),f=u(null),V=K(()=>{switch(i.value){case"queue":return"Queue (Pending)";case"approved":return"Approved Puzzles";case"rejected":return"Rejected Puzzles";case"history":return"Archived History";default:return"Dashboard"}}),D=async()=>{v.value=!0;try{console.log("Fetching waiting puzzles...");const t=b(h(z,"waitingPuzzles")),e=await k(t);console.log("Query result:",e.size,"documents found"),r.value=e.docs.map(s=>(console.log("Document data:",s.id,s.data()),{id:s.id,...s.data()})),console.log("Waiting puzzles:",r.value)}catch(t){console.error("Error fetching puzzles:",t),console.error("Error code:",t.code),console.error("Error message:",t.message)}finally{v.value=!1}},I=async()=>{v.value=!0;try{const t=b(h(z,"approvedPuzzles"),F("createdAt","asc")),e=await k(t);c.value=e.docs.map(s=>({id:s.id,...s.data()}))}catch(t){console.error("Error fetching approved puzzles:",t)}finally{v.value=!1}},O=t=>{const e=new Date,s=5.5*60*60*1e3,o=new Date(e.getTime()+s),g=f.value?1:0;return o.setDate(o.getDate()+g+t),o.toLocaleDateString("en-IN",{weekday:"short",day:"numeric",month:"short"})},Q=async()=>{v.value=!0;try{const t=b(h(z,"rejectedPuzzles")),e=await k(t);d.value=e.docs.map(s=>({id:s.id,...s.data()}))}catch(t){console.error("Error fetching rejected puzzles:",t)}finally{v.value=!1}},M=async()=>{v.value=!0;try{const t=b(h(z,"historyPuzzles"),F("movedToHistoryAt","desc"),Y(50)),e=await k(t);y.value=e.docs.map(s=>({id:s.id,...s.data()}))}catch(t){console.error("Error fetching history puzzles:",t)}finally{v.value=!1}},m=t=>{i.value=t,t==="queue"?D():t==="approved"?I():t==="rejected"?Q():t==="history"&&M()},W=async()=>{try{const t=await Z();f.value=t}catch(t){console.error("Error fetching display puzzle:",t)}};U(()=>{$.onAuthStateChanged(t=>{t?(P.value=!0,D(),W()):q.push("/"),w.value=!1})});const E=async t=>{try{const e=r.value.find(o=>o.id===t)||d.value.find(o=>o.id===t);if(!e){console.error("Puzzle not found");return}const s=r.value.find(o=>o.id===t)?"waitingPuzzles":"rejectedPuzzles";await L(h(z,"approvedPuzzles"),{movieName:e.movieName,submittedBy:e.submittedBy,clues:e.clues,createdAt:e.createdAt,approvedAt:R()}),await j(A(z,s,t)),r.value=r.value.filter(o=>o.id!==t),d.value=d.value.filter(o=>o.id!==t)}catch(e){console.error("Error approving puzzle:",e),alert("Failed to approve puzzle")}},N=async t=>{try{const e=r.value.find(o=>o.id===t)||c.value.find(o=>o.id===t);if(!e){console.error("Puzzle not found");return}const s=r.value.find(o=>o.id===t)?"waitingPuzzles":"approvedPuzzles";await L(h(z,"rejectedPuzzles"),{movieName:e.movieName,submittedBy:e.submittedBy,clues:e.clues,createdAt:e.createdAt,rejectedAt:R()}),await j(A(z,s,t)),r.value=r.value.filter(o=>o.id!==t),c.value=c.value.filter(o=>o.id!==t)}catch(e){console.error("Error rejecting puzzle:",e),alert("Failed to reject puzzle")}},B=async t=>{if(confirm("Are you sure you want to permanently delete this puzzle?"))try{let e="waitingPuzzles";c.value.find(s=>s.id===t)?e="approvedPuzzles":d.value.find(s=>s.id===t)?e="rejectedPuzzles":y.value.find(s=>s.id===t)&&(e="historyPuzzles"),await j(A(z,e,t)),r.value=r.value.filter(s=>s.id!==t),c.value=c.value.filter(s=>s.id!==t),d.value=d.value.filter(s=>s.id!==t),y.value=y.value.filter(s=>s.id!==t)}catch(e){console.error("Error deleting puzzle:",e),alert("Failed to delete puzzle")}},G=async()=>{try{await $.signOut(),P.value=!1,T.value="",H.value="",q.push("/")}catch(t){console.error("Error logging out:",t)}};return(t,e)=>(n(),a("div",ee,[l("div",te,[l("div",se,[e[4]||(e[4]=l("h1",{class:"title"},"Admin Dashboard",-1)),l("h2",le,p(V.value),1)])]),!w.value&&P.value?(n(),a("div",oe,[f.value?(n(),a("div",ae,[C("",!0),e[6]||(e[6]=l("div",{class:"card-header"},[l("h3",null,"ðŸŽ¯ Live Now"),l("span",{class:"pulse-dot"})],-1)),l("div",ne,p(f.value.movieName),1),l("div",ie,[l("span",re,"by "+p(f.value.submittedBy),1),e[5]||(e[5]=l("span",{class:"expiry"},"Expires 11:59 PM",-1))])])):(n(),a("div",ue,[...e[7]||(e[7]=[l("p",null,"âš ï¸ No active puzzle",-1),l("span",{class:"auto-note"},"Auto-fill active",-1)])]))])):C("",!0),w.value?(n(),a("div",ce,[...e[8]||(e[8]=[l("div",{class:"spinner"},null,-1),l("p",null,"Checking authentication...",-1)])])):(n(),a("div",de,[l("div",ve,[l("button",{onClick:e[0]||(e[0]=s=>m("queue")),class:_(["sidebar-btn",{active:i.value==="queue"}]),title:"Queue (Pending)"}," â³ ",2),l("button",{onClick:e[1]||(e[1]=s=>m("approved")),class:_(["sidebar-btn",{active:i.value==="approved"}]),title:"Approved"}," âœ¨ ",2),l("button",{onClick:e[2]||(e[2]=s=>m("rejected")),class:_(["sidebar-btn",{active:i.value==="rejected"}]),title:"Rejected"}," ðŸ—‘ï¸ ",2),l("button",{onClick:e[3]||(e[3]=s=>m("history")),class:_(["sidebar-btn",{active:i.value==="history"}]),title:"Archives (History)"}," ðŸ“œ ",2),e[9]||(e[9]=l("div",{class:"sidebar-divider"},null,-1)),l("button",{onClick:G,class:"sidebar-btn logout-btn",title:"Logout"}," ðŸ‘‹ ")]),v.value?(n(),a("div",pe,[...e[10]||(e[10]=[l("div",{class:"spinner"},null,-1),l("p",null,"Loading puzzles...",-1)])])):i.value==="queue"&&r.value.length===0?(n(),a("div",ze,[...e[11]||(e[11]=[l("p",null,"No pending puzzles to review.",-1)])])):i.value==="approved"&&c.value.length===0?(n(),a("div",ye,[...e[12]||(e[12]=[l("p",null,"No approved puzzles yet.",-1)])])):i.value==="rejected"&&d.value.length===0?(n(),a("div",he,[...e[13]||(e[13]=[l("p",null,"No rejected puzzles.",-1)])])):i.value==="history"&&y.value.length===0?(n(),a("div",fe,[...e[14]||(e[14]=[l("p",null,"No archived puzzles.",-1)])])):(n(),a("div",me,[(n(!0),a(x,null,S(i.value==="queue"?r.value:i.value==="approved"?c.value:i.value==="rejected"?d.value:y.value,s=>(n(),a("div",{key:s.id,class:"puzzle-card glass-panel"},[l("div",ge,[l("div",_e,[l("h3",be,"ðŸŽ¬ "+p(s.movieName),1),l("div",ke,[l("span",Pe,"ðŸ‘¤ "+p(s.submittedBy),1),l("span",we,"ðŸ“ "+p(s.clues.length)+" clues",1)])]),i.value==="queue"?(n(),a("div",Ce,[l("button",{onClick:o=>E(s.id),class:"btn-approve"}," âœ“ Approve ",8,je),l("button",{onClick:o=>N(s.id),class:"btn-reject"}," âœ• Reject ",8,Ae)])):i.value==="approved"?(n(),a("div",qe,[l("div",De," ðŸ“… Live: "+p(O(c.value.findIndex(o=>o.id===s.id))),1),l("button",{onClick:o=>N(s.id),class:"btn-reject"}," âœ• Reject ",8,Ee)])):i.value==="rejected"?(n(),a("div",Ne,[l("button",{onClick:o=>E(s.id),class:"btn-approve"}," âœ“ Approve ",8,Be),l("button",{onClick:o=>B(s.id),class:"btn-delete"}," ðŸ—‘ï¸ Delete ",8,$e)])):i.value==="history"?(n(),a("div",xe,[l("button",{onClick:o=>B(s.id),class:"btn-delete"}," ðŸ—‘ï¸ Delete ",8,Se)])):C("",!0)]),l("div",Fe,[e[15]||(e[15]=l("h4",{class:"clues-title"},"Clues (Hardest â†’ Easiest)",-1)),l("ol",Le,[(n(!0),a(x,null,S(s.clues,(o,g)=>(n(),a("li",{key:g,class:"clue-item"},[l("span",Re,"#"+p(g+1),1),l("span",Te,p(o),1)]))),128))])])]))),128))]))]))]))}},Qe=J(He,[["__scopeId","data-v-84425103"]]);export{Qe as default};
